create database billing;
\c billing 
create table customers(customer_id serial,MSISDN text,customer_name text,birthdate text,address text,job text,billcycle text,primary key(customer_id));
create table profile(profile_id serial,profile_name text,primary key(profile_id)); 
create table packages(package_id serial, package_name text,primary key(package_id )); 
create table services(service_id serial,service_name text, service_price int, time_zone text,tarrif_zone text,R_or_one  text,FU text, FU_description text,primary key(service_id));
create table UDR (MSISDN text, destination text,duration varchar(40),cost int,time text,primary key(MSISDN));
create table previous_bills(URL text,primary key(URL)); 

alter table services alter column R_or_one type boolean using R_or_one::boolean; 

ALTER TABLE profile ADD COLUMN fees float;

alter table customers add column profile_id serial, add CONSTRAINT fk_1 FOREIGN KEY (profile_id)  REFERENCES profile (profile_id);
alter table packages add column service_id serial, add CONSTRAINT fk_2 FOREIGN KEY (service_id)  REFERENCES services (service_id);
alter table profile add column MSISDN text, add CONSTRAINT fk_3 FOREIGN KEY (MSISDN)  REFERENCES UDR  (MSISDN);
alter table  previous_bills add column customer_id serial, add CONSTRAINT fk_4 FOREIGN KEY (customer_id)  REFERENCES customers(customer_id); 
alter table  UDR add column customer_id serial, add CONSTRAINT fk_4 FOREIGN KEY (customer_id)  REFERENCES customers(customer_id); 

CREATE TABLE  profile_packages(
  profile_id     serial REFERENCES profile (profile_id) ON UPDATE CASCADE ON DELETE CASCADE
, package_id serial  REFERENCES packages(package_id) ON UPDATE CASCADE ON DELETE CASCADE
, CONSTRAINT  profile_packages_pkey PRIMARY KEY ( profile_id ,  package_id ) 
);  

